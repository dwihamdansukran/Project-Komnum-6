import numpy as np
import pandas as pd
from tabulate import tabulate  # Memerlukan library tabulate
import tkinter as tk
from tkinter import messagebox
import matplotlib.pyplot as plt  # Memerlukan library matplotlib

# Fungsi untuk menjalankan evaluasi fungsi yang dimasukkan pengguna
def f(x):
    try:
        return eval(func_input.get())
    except Exception as e:
        messagebox.showerror("Error", f"Error in function evaluation: {e}")
        return None

# Fungsi utama untuk melakukan perhitungan dan menampilkan hasil
def calculate():
    global data  # Menyimpan data ke variabel global untuk digunakan di plot
    try:
        N = int(entry_N.get())  # Mengambil jumlah langkah N dari input
        batas_bawah = float(entry_bawah.get())  # Mengambil batas bawah dari input
        batas_atas = float(entry_atas.get())  # Mengambil batas atas dari input

        # xera Menyiapkan list untuk menyimpan data tabel

        # Melakukan iterasi untuk menghitung xi, f(xi), dan f(xi+1)
        for i in range(1, N + 2):
            xi = batas_bawah + (i - 1) * H
            fi = f(xi)

            if i < N + 1:
                fi_next = f(batas_bawah + i * H)
            else:
                fi_next = None

            product = fi * fi_next if fi_next is not None else None
            data.append([xi, fi, fi_next, product])

            # Mengecek kondisi |f(xk)| < |f(xk+1)| dan menyimpan iterasi pertama yang memenuhi syarat
            if chosen_iteration is None and i < N + 1 and abs(fi) < abs(fi_next):
                chosen_iteration = i
                chosen_x = xi

        # Membuat DataFrame untuk menyimpan hasil perhitungan
        df = pd.DataFrame(data, columns=['      xi', '      f(xi) ', '          f(x(i+1)) ', '      f(xi) * f(x(i+1))'])

        # Menghapus konten sebelumnya dari TextBox hasil
        result_box.delete(1.0, tk.END)

        # Menggunakan tabulate untuk merapikan tampilan tabel dalam bentuk grid
        table_str = tabulate(df, headers='keys', floatfmt=".4f", numalign="center")
        result_box.insert(tk.END, table_str)  # Menampilkan tabel dalam TextBox

        # xera Menampilkan hasil iterasi yang memenuhi syarat
    
# Fungsi untuk menampilkan plot
def show_plot():
    if not data:
        messagebox.showerror("Error", "Tidak ada data untuk diplot. Harap hitung terlebih dahulu.")
        return

    # Memisahkan data untuk plot
    x_values = [row[0] for row in data]
    y_values = [row[1] for row in data]

    plt.figure(figsize=(10, 5))
    plt.plot(x_values, y_values, marker='o', linestyle='-', color='blue')
    plt.title('Plot Fungsi f(x)')
    plt.xlabel('xi')
    plt.ylabel('f(xi)')
    plt.grid(True)
    plt.axhline(0, color='red',linewidth=2.0, ls='--')  # Garis horizontal pada y=0
    plt.axvline(0, color='black',linewidth=0.5, ls='--')  # Garis vertikal pada x=0
    plt.show()

# Fungsi untuk menambah karakter ke input fungsi saat tombol di keyboard virtual ditekan
def insert_key(value):
    func_input.insert(tk.END, value)

# Membuat aplikasi utama
root = tk.Tk()
root.title("Metode Tabel Kelompok 6")
root.geometry("500x950")  # Menambah tinggi window untuk keyboard
root.configure(bg='#001F3F')  # Warna background navy

# Judul Aplikasi
judul = tk.Label(root, text="Metode Tabel", font=('Comic Sans MS', 16, 'bold'), bg='#001F3F', fg='#FFFFFF')
judul.pack(pady=10)

# xera Frame utama untuk mengelompokkan input, hasil, dan keyboard
main_frame = tk.Frame(root, bg='#001F3F')
main_frame.pack(pady=10)

# ren Bingkai untuk input pengguna
frame_input = tk.Frame(main_frame, bg='#001F3F', borderwidth=2, relief='groove')  # Bingkai dengan relief dan border
frame_input.pack(pady=8, fill=tk.X)

